<% days = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday",
           "Saturday"] %>
<p>
  Time <br />
  <select id="hour">
    <% for hour in 0..23 %>
      <option value="<%= hour %>"><%= hour %></option>
    <% end %>
  </select>
  :
  <select id="minute">
    <% for minute in 0..59 %>
      <option value="<%= minute %>"><%= minute %></option>
    <% end %>
  </select>
</p>

<p>
  Description <br />
  <input id="description" type="text"></input>
</p>

<table id="cal_table" class="table table-bordered">
  <tr>
    <th><a href="javascript:setDate(-1, 0);">&lt;&lt;</a></th>
    <th><a href="javascript:setDate(0, -1);">&lt;</a></th>
    <th colspan="3" id="month">January 2013</th>
    <th><a href="javascript:setDate(0, 1);">&gt;</a></th>
    <th><a href="javascript:setDate(1, 0);">&gt;&gt;</a></th>
  </tr>
  <tr>
    <% for day in days %>
      <th><%= day %></th>
    <% end %>
  </tr>
  <% for i in 0..5 %>
    <tr>
    <% for j in 0..6 %>
      <td id="<%= "cell_#{i}_#{j}" %>">
        <%= i * 5 + j %>
      </td>
    <% end %>
    </tr>
  <% end %>
</table>

<script>
  // Note that month starts with January at 0 - so October is 9, not September.
  months = ["January", "Febuary", "March", "April", "May", "June", "July",
            "August", "September", "October", "November", "December"];

  function getNumberOfDaysInMonth(year, month)
  {
    return (new Date(year, month + 1, 0)).getDate();
  }

  function getFirstDayOfMonth(year, month)
  {
    return (new Date(year, month, 1)).getDay();
  }

  function getCurrentDayMonthYear(){

    return (new Date());
  }

  function redrawCalendar(year, month)
  {
    $("#month").text(months[month] + " " + year);

    firstDay = getFirstDayOfMonth(year, month);
    numberOfDays = getNumberOfDaysInMonth(year, month);
    currentDay = getCurrentDayMonthYear().getDate();
    currentMonth = getCurrentDayMonthYear().getMonth();
    currentYear = getCurrentDayMonthYear().getFullYear();

    day = 1;
    count= 0;

    for (var i = 0; i < 6; i++) {
      for (var j = 0; j < 7; j++) {
        if (((i * 6 + j) >= firstDay) && (day <= numberOfDays)) {
          $("#cell_" + i + "_" + j).text(day++);
        } else {
          $("#cell_" + i + "_" + j).text("");
        }

        //highlights current day in light blue. Makes sure to unhighlight in other months.
        //there is a better way to do this. If I have time I'll implement it.
        if((year == currentYear) && (month == currentMonth) && (day == currentDay)){
          $("#cell_" + i + "_" + j).css("backgroundColor", "lightblue");
        }
        else{
          $("#cell_" + i + "_" + j).css("backgroundColor", "white");
        } 

      }
    }
  }

  // setMonth() takes a number of years/months to go up or down
  // For now don't use values larger than +/- 1, I didn't have the time to do
  // the correct math. -js
  function setDate(yearsDelta, monthsDelta)
  {
    year += yearsDelta;
    month += monthsDelta;
    
    // Change the year if necessary
    if (month > 11) {
      year += 1;
      month = 0;
    } else if (month < 0) {
      year -= 1;
      month = 11;
    }

    redrawCalendar(year, month);
  }


  //If a click occurs on the table add the a div containing the information to be logged. 
  $('#cal_table td').click(function(){

      //find location of cell clicked
      var rowIndex = $(this).parent().index('#cal_table tr');
      var tdIndex = $(this).index('#cal_table tr:eq('+rowIndex+') td');

      //if the cell is not empty we are able to add otherwise it is an empty cell. Can't add to empty cell.
      if($(this).html()){
            $(this).append('<div id="event">' + $("#hour").val() + ":" + $("#minute").val() + $("#description").val() + '</div>');
          
            $("#hour").val($("#hour option:first").val());
            $("#minute").val($("#minute option:first").val());
            $("#description").val('');
      }
  });

  $(document).ready(function()
  {
    // Get the current date
    var date = new Date();

    // Month and year are attached to window so they persist (globals)
    window.month = date.getMonth();
    window.year = date.getFullYear();

    // Redraw the calendar so it matches the current date
    redrawCalendar(year, month);
  });
</script>
